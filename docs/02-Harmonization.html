<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Harmonization</title>

<script src="site_libs/header-attrs-2.17/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">HOME</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="01-SAE-Tool.html">SAE tool</a>
</li>
<li>
  <a href="02-Harmonization.html">Harmonization</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Harmonization</h1>

</div>


<div id="harmonization" class="section level1">
<h1>Harmonization</h1>
<p>This manual provides a step-by-step guide to harmonizing census and
survey data for the purposes of small area estimation (SAE). More
specifically, we describe how to create harmonized files of census data
from IPUMS International (IPUMSI) and survey data from Demographic and
Health Surveys (DHS). These harmonized data files can subsequently be
used to construct SAE models for DHS indicator variables.</p>
<p>To motivate the technical instructions in this manual, we consider a
case study involving data from the West African nation of Sierra Leone.
Our objective is to construct SAE models for three DHS indicators: (1)
Any contraceptive use, (2) modern contraceptive use, and (3) unmet need.
To do so, we need to assemble harmonized data sets containing all the
relevant predictor variables appearing in both the 2015 IPUMS sample and
the 2019 DHS sample, as well as the appropriate geographic
variables.</p>
<p>The diagram below provides a visual overview of the data
harmonization procedure that we introduce in this manual:</p>
<div class="figure">
<img src="img/Data%20Harmonization%20Flowchart.png" id="id"
class="class" style="width:70.0%;height:70.0%" alt="" />
<p class="caption">Harmonization flowchart</p>
</div>
</div>
<div id="step-1-download-data" class="section level1">
<h1>Step 1: Download data</h1>
<div id="step-1a-ipums-data-and-shapefiles" class="section level2">
<h2>Step 1A: IPUMS data and shapefiles</h2>
<p>Navigate to the IPUMS International homepage (<a
href="https://international.ipums.org/international"
class="uri">https://international.ipums.org/international</a>):</p>
<div class="figure">
<img src="img/manual_step_1a.png" id="id" class="class"
style="width:70.0%;height:70.0%" alt="" />
<p class="caption">Harmonization flowchart</p>
</div>
<p>If this is your first time downloading data from IPUMS International,
you will need to register for an account by clicking the blue “Register”
button. If you already have an IPUMS International account, click the
“Log In” button in the top right corner of the page.</p>
<p>Once you have logged into your account, you can begin creating a
census data extract. Proceed as follows:</p>
<ol style="list-style-type: decimal">
<li>Click on “Select Data”.</li>
<li>Click the blue “Select Samples” button in the top left corner.</li>
<li>You should see a column of countries, each with a corresponding row
of years for which data are available. Identify the country of interest
and check the box to the left of the year for which you would like to
download the data. Then click the blue “Submit Sample Selections” button
near the top of the page.</li>
<li>You should now have one sample in your data cart. Next, mark the
circular button next to either “Harmonized Variables” or “Source
Variables”, depending on which type of variable you would like to use in
your analysis. There is no wrong answer here — either harmonized
variables or source variables can be used successfully for small area
estimation. To read about the differences between the two, see the IPUMS
International FAQ page (<a
href="https://international.ipums.org/international-action/faq"
class="uri">https://international.ipums.org/international-action/faq</a>).
For the Sierra Leone case study, we will use source variables.</li>
<li>Click the “Display Options” button in the top right corner of the
page. Under the “Variable groups” heading, select “Show all groups
together”. Then click “Apply Selections”.</li>
<li>You should now see a long list of variables. Add all of them to your
data cart by clicking the circular plus sign next to each variable. Once
you have filled your cart with all of the variables, click the blue
“View Cart” button in the upper right corner of the page.</li>
<li>Take a quick look at the list of variables on the next page and
verify that everything looks correct. Then click the blue “Create Data
Extract” button.</li>
<li>This will bring you to the extract request page. In the row labeled
“Data Format”, click on the word “Change”. Then, under the “Data Format”
heading, change the format from “Fixed-width text (.dat)” to “SPSS
(.sav)”. Then click the “Apply Selections” button at the bottom of the
page.</li>
<li>If you’d like, you can add a short description of your data extract.
Then click “Submit Extract”.</li>
<li>This will bring you to a page where you can download your extract.
Depending on the size of the extract you created, it may take a little
while to process. You will receive an email when it is ready to
download. To download your data, click the green “Download SPSS”
button.</li>
<li>Give the downloaded file a meaningful name and move it to a suitable
directory.</li>
</ol>
<p>You will also need to download the shapefile for the sample you
selected above. For most small area estimation models, the initial model
will be constructed at IPUMS’s first administrative level using the
survey data, and the model will make predictions at IPUMS’s second
administrative level using the census data. In the case of Sierra Leone,
for example, the DHS indicators are modeled at the district level (first
administrative level), and predictions are made at the chiefdom level
(second administrative level).</p>
<p>Navigate to IPUMS International’s GIS boundary files page (<a
href="https://international.ipums.org/international/gis.shtml"
class="uri">https://international.ipums.org/international/gis.shtml</a>).
Proceed as follows:</p>
<ol style="list-style-type: decimal">
<li>Click on “Year-specific second-level geography”.</li>
<li>You should see a list of countries, along with a row of years for
which the geographic data are available. Identify your country of
interest and click the year for which you downloaded data above.</li>
<li>This will download a folder containing the corresponding shapefiles.
Rename the folder if you’d like, and then move it to the directory from
Step 11 above.</li>
</ol>
</div>
<div id="step-1b-dhs-data-and-shapefiles" class="section level2">
<h2>Step 1B: DHS data and shapefiles</h2>
<p>Navigate to the DHS homepage (<a href="https://dhsprogram.com"
class="uri">https://dhsprogram.com</a>):</p>
<div class="figure">
<img src="img/manual_step_1b.png" id="id" class="class"
style="width:70.0%;height:70.0%" alt="" />
<p class="caption">Harmonization flowchart</p>
</div>
<p>Click on “Login” at the top of the page. If this is your first time
downloading DHS data, you will need to register for a new account. If
you have downloaded DHS data before, you can log into your existing
account.</p>
<p>Once you have logged into your account, proceed as follows to
download the survey data and corresponding shapefiles:</p>
<ol style="list-style-type: decimal">
<li>Hover over the “Data” menu at the top of the page and select
“Download Datasets”.</li>
<li>In the blue “Select Country” dropdown menu, select the country of
interest.</li>
<li>You should see a list of surveys from the country of interest. Out
of all the Standard DHS samples (see the “Type” column), identify the
one closest in year to the IPUMS sample from Step 1A. Ideally, there
should be no more than a four- or five-year gap between the IPUMS and
DHS samples. In the “Survey Datasets” column, click on “Data Available”
for this sample.</li>
<li>This will bring you to a page containing a long list of data files.
Under the “Individual Recode” heading in the “Survey Datasets” section,
download the .zip file for the SPSS dataset (.sav). Once this .zip file
is downloaded, unzip it. Give the downloaded files meaningful names and
place them in the directory from Step 11 above.</li>
<li>Under the “Geographic Data” heading in the “Geographic Datasets”
section, download the .zip file for the shape file (.shp). Once this
.zip file is downloaded, unzip it. Give the downloaded files meaningful
names and place them in the directory from Step 11 above.</li>
</ol>
</div>
</div>
<div id="step-2-sae-preliminaries" class="section level1">
<h1>Step 2: SAE preliminaries</h1>
<div id="step-2a-identify-dhs-indicators-of-interest"
class="section level2">
<h2>Step 2A: Identify DHS indicators of interest</h2>
<p>After downloading the data, the first step is to identify which DHS
indicator(s) you are interested in modeling. DHS samples contain many
variables that record information about a wide range of topics,
including health behaviors, family planning, and more. Since the
processes of data harmonization and SAE modeling are often motivated by
a specific real-world problem, it is likely that you have already
identified the indicator(s) of interest.</p>
<p>At this stage, it is helpful to note the name(s) of the DHS
variable(s) that can be used to construct these indicator(s). Each
variable name is a string of capital letters and numbers, usually
beginning with “V”. These variable names can be identified using the
Guide to DHS Statistics page (<a
href="https://dhsprogram.com/Data/Guide-to-DHS-Statistics/index.cfm"
class="uri">https://dhsprogram.com/Data/Guide-to-DHS-Statistics/index.cfm</a>)
on the DHS website:</p>
<div class="figure">
<img src="img/manual_step_2a.png" id="id" class="class"
style="width:70.0%;height:70.0%" alt="" />
<p class="caption">Harmonization flowchart</p>
</div>
<p>You can also identify the variable names later, after you load the
DHS data into <code>R</code> in Step 3C.</p>
<p>For the Sierra Leone case study, we are interested in three
indicators:</p>
<ol style="list-style-type: decimal">
<li>Any contraceptive use (constructed using V313)</li>
<li>Modern contraceptive use (constructed using V313)</li>
<li>Unmet need (constructed using V626)</li>
</ol>
</div>
<div id="step-2b-identify-variables-to-harmonize"
class="section level2">
<h2>Step 2B: Identify variables to harmonize</h2>
<p>The next step is to identify all the variables that (1) appear in
both the IPUMS and DHS samples and (2) could reasonably be used to
predict the DHS indicator(s) listed in Step 2A. Here are some common
predictor variables that are likely to appear in both the IPUMS and DHS
samples:</p>
<ul>
<li>Age</li>
<li>Marital status</li>
<li>Educational attainment</li>
<li>Religion</li>
<li>Number of children ever born</li>
<li>Number of children surviving</li>
<li>Urban/rural status</li>
<li>Employment status</li>
<li>Occupation</li>
<li>Literacy</li>
<li>Primary language</li>
<li>Ethnicity</li>
<li>Relationship to household head</li>
<li>Ownership of durable goods (e.g., car, bicycle, refrigerator,
television, radio, phone)</li>
<li>Household characteristics (e.g., floor material, roof material, wall
material, water source, electricity, toilet, cooking fuel)</li>
</ul>
<p>Note that this list is just a starting point — you may find other
variables with predictive potential that appear in both samples.</p>
<p>Just like in Step 2A, it is helpful at this stage to identify the
names corresponding to these predictor variables in both the DHS and
IPUMS samples. For the DHS data, these variable names can be identified
using the Guide to DHS Statistics page (<a
href="https://dhsprogram.com/Data/Guide-to-DHS-Statistics/index.cfm"
class="uri">https://dhsprogram.com/Data/Guide-to-DHS-Statistics/index.cfm</a>)
on the DHS website — see the screenshot in Step 2A. For the IPUMS data,
the variable names can be identified via the variable list for your
sample on the IPUMS International website (e.g., <a
href="https://international.ipums.org/international-action/variables/samples?id=sl2015a"
class="uri">https://international.ipums.org/international-action/variables/samples?id=sl2015a</a>):</p>
<div class="figure">
<img src="img/manual_step_2b.png" id="id" class="class"
style="width:70.0%;height:70.0%" alt="" />
<p class="caption">Harmonization flowchart</p>
</div>
<p>You can also confirm the variable names for your predictors after you
load the IPUMS and DHS data into <code>R</code> in Steps 3B and 3C,
respectively.</p>
<p>In some cases, one variable in either the IPUMS or DHS sample may be
comparable with a combination of two or more variables in the other
sample. For example, variable <code>V125</code> from the Sierra Leone
DHS data records whether the individual resides in a household that owns
a car or a truck. However, in the Sierra Leone IPUMS data, this
information is split up into two variables: <code>SL2015A_CAR</code>
records whether the individual lives in a household that owns a car,
while <code>SL2015A_TRUCK</code> records whether the individual lives in
a household that owns a truck.</p>
<p>You will also need to harmonize the survey area variable, which is
typically the first IPUMS administrative level. This variable should, by
the principles of SAE, appear in both the DHS sample and the IPUMS
sample. In the case of Sierra Leone, district is the survey area
variable.</p>
<p>I would suggest making a spreadsheet to keep track of the variable
names from each sample. Here is a short example for the Sierra Leone
data:</p>
<p>At this stage, you should also identify the census area variable,
which is typically the second IPUMS administrative level. By the
principles of SAE, this variable should appear in the IPUMS sample, but
not the DHS sample. Thus, you cannot harmonize the census area across
the two samples, but it is worthwhile to identify the variable name
associated with it. In the case of Sierra Leone, chiefdom is the census
area variable.</p>
</div>
<div id="step-2c-determine-target-population" class="section level2">
<h2>Step 2C: Determine target population</h2>
<p>You should also determine the target population for your analysis —
i.e., the demographic subset that is comparable across the IPUMS and DHS
samples. Four characteristics that often (but not always) define the
target population are:</p>
<ol style="list-style-type: decimal">
<li>Sex
<ul>
<li>Since censuses collect data for respondents of both sexes, this is
primarily a concern for the DHS sample. Are the DHS indicators of
interest recorded for women only, men only, or both? (Note that if you
know this in advance, you can also filter by sex when downloading the
DHS data in Step 1B.)</li>
</ul></li>
<li>Age
<ul>
<li>Since censuses collect data for respondents of all ages, this is
primarily a concern for the DHS sample. DHS typically collects data only
for individuals aged 15-49 (or 15-59).</li>
</ul></li>
<li>Household ownership
<ul>
<li>Were the data in each sample collected from individuals in private
households, collective dwellings, or both? This needs to be confirmed
for both the IPUMS and DHS samples. DHS typically collects data only
from private households, but censuses may collect data from collectives
for some variables. This information can be retrieved from census
documentation, which is often available on either the IPUMS website or
the national statistical office of the country of interest. It can also
be useful to check the universe tab (e.g., <a
href="https://international.ipums.org/international-action/variables/SL2015A_0404#universe_section"
class="uri">https://international.ipums.org/international-action/variables/SL2015A_0404#universe_section</a>)
for individual variables in the IPUMS sample.</li>
</ul></li>
<li>Residence status
<ul>
<li>Were the samples extracted from a de jure population or a de facto
population? In a de jure survey/census, each respondent is enumerated
based on their usual residence, regardless of where they are located on
the day of the survey/census. In a de facto census, each respondent is
enumerated based on their location on the day of the survey/census,
regardless of where they usually reside. De jure/de facto status can
usually be retrieved from census and DHS documentation.</li>
</ul></li>
</ol>
<p>In some cases, other variables (e.g., marital status, household
occupancy/vacancy) may also shape the target population. It is important
to consider the unique circumstances of your research question and
analysis plan. For the Sierra Leone case study, the target population is
the de facto population of women aged 15-49 in occupied, private
households.</p>
</div>
</div>
<div id="step-3-data-preparation" class="section level1">
<h1>Step 3: Data preparation</h1>
<p>For the remainder of this manual, we will illustrate the processes of
data cleaning and harmonization using data from Sierra Leone. Please
note that while the general procedures in Steps 3, 4, and 5 are
applicable to other SAE projects, the specific tasks required for other
projects may vary.</p>
<p>If you do not already have <code>R</code> and <code>RStudio</code>
downloaded on your computer, you will need to download them before
proceeding. This page (<a href="https://cran.r-project.org"
class="uri">https://cran.r-project.org</a>) provides instructions for
downloading <code>R</code>, and this page (<a
href="https://www.rstudio.com/products/rstudio/download/"
class="uri">https://www.rstudio.com/products/rstudio/download/</a>)
provides instructions for downloading <code>RStudio</code>. Once you
have downloaded them, create a new R script called
<code>[Country name] harmonization.R</code>.</p>
<div id="step-3a-packages-and-user-defined-functions"
class="section level2">
<h2>Step 3A: Packages and user-defined functions</h2>
<p>Before reading in the data sets you downloaded in Step 1, load the
following packages into <code>R</code> using the <code>library()</code>
function.</p>
<pre class="r"><code>library(foreign)
library(tibble)
library(haven)
library(expss)
library(dplyr)
library(openxlsx)</code></pre>
<p>Note: If you have not previously one or more of these packages, you
will need to install them using the <code>install.packages()</code>
function (e.g.,
<code>install.packages(</code>“foreign”<code>)</code>).</p>
<p>We will also make use of four user-defined functions that are
designed to clean up the harmonization process:
<code>compare_categories()</code>, <code>new_var_label()</code>,
<code>write_ipums_output()</code>, and <code>write_dhs_output()</code>.
See the Appendix to read about these functions in detail. Feel free to
ignore these details for now, though — you can always refer back to them
later.</p>
</div>
<div id="step-3b-ipums-data-preparation" class="section level2">
<h2>Step 3B: IPUMS data preparation</h2>
<p>First, identify the path to the IPUMS data file you downloaded in
Step 1A:</p>
<pre class="r"><code>path_ipums = &quot;~/_OriginalData/SierraLeoneIPUMS2015/sl2015a_ipums.sav&quot;</code></pre>
<p>Next, store the IPUMS data file as a data frame. It may be helpful to
store an original version of the data frame and make a copy for your
actual analysis:</p>
<pre class="r"><code># Store original
sl2015_ipums_orig = read.spss(path_ipums, to.data.frame = TRUE)

# Make copy
sl2015_ipums = sl2015_ipums_orig</code></pre>
<p>If you’d like, you can use the <code>View()</code> and
<code>colnames()</code> functions to view a list of the names of all of
the variables in the IPUMS data frame. This may be helpful if you did
not identify the names of all of your predictor variables in Step
2B.</p>
<pre class="r"><code>View(colnames(sl2015_ipums))</code></pre>
<p>For the Sierra Leone data, it is necessary to convert age to a
numeric variable, as it was categorical by default. This is an example
of a country-specific data cleaning task. You may not need to do this
for other countries, but you may also find that adjustments need to be
made for other variables.</p>
<pre class="r"><code>levels(sl2015_ipums$SL2015A_AGE)[1:3] = c(&quot;0&quot;, &quot;1&quot;, &quot;2&quot;)

levels(sl2015_ipums$SL2015A_AGE)[which(levels(sl2015_ipums$SL2015A_AGE) == &quot;101+ years&quot;)] = &quot;101&quot;

sl2015_ipums$SL2015A_AGE = as.numeric(sl2015_ipums$SL2015A_AGE) - 1</code></pre>
<p>Finally, filter the data frame to obtain the target population
identified in Step 2C. You may need to explore the data frame a bit to
figure out how to do this.</p>
<pre class="r"><code>sl2015_ipums = sl2015_ipums[(sl2015_ipums$SL2015A_SEX == &quot;Female&quot; &amp; 
                               sl2015_ipums$SL2015A_AGE &gt;= 15 &amp; sl2015_ipums$SL2015A_AGE &lt;= 49 &amp;
                               sl2015_ipums$SL2015A_HHTYPE == &quot;Household&quot;),]</code></pre>
</div>
<div id="step-3c-dhs-data-preparation" class="section level2">
<h2>Step 3C: DHS data preparation</h2>
<p>Here, we essentially reapply the procedures from Step 3B for the DHS
sample. First, identify the path to the DHS data file you downloaded in
Step 1B:</p>
<pre class="r"><code>path_dhs = &quot;~/_OriginalData/SierraLeoneDHS2019/SL_2019_DHS_10012021_1417_61748/SLIR7ASV/SLIR7AFL.SAV&quot;</code></pre>
<p>Next, store the DHS data file as a data frame. Again, it may be
helpful to store an original version of the data frame and make a copy
for your actual analysis:</p>
<pre class="r"><code># Store original
sl2019_dhs_ir_orig = read.spss(path_dhs, to.data.frame = TRUE)

# Make copy
sl2019_dhs_ir = sl2019_dhs_ir_orig</code></pre>
<p>If you’d like, you can use the <code>View()</code> and
<code>attr()</code> functions to view a list of the names of all of the
variables in the DHS data frame. This may be helpful if you did not
identify the names of your indicator(s) of interest in Step 2A or your
DHS predictors in Step 2B.</p>
<pre class="r"><code>View(attr(sl2019_dhs_ir, &quot;variable.labels&quot;))</code></pre>
<p>At this point, you may need to clean the data and/or filter it in
some way to obtain the target population, much like we did in Step 3B.
For the DHS data from Sierra Leone, neither of these tasks were
necessary.</p>
<p>Next, you will need to rescale the individual sample weight variable
(<code>V005</code>) by dividing it by 1,000,000. Then use the
user-defined function <code>new_var_label()</code> to assign a label to
the new weight variable. This new variable label should be the original
label concatenated with “(recode)”.</p>
<pre class="r"><code># Rescale sample weight
sl2019_dhs_ir$V005R = sl2019_dhs_ir$V005/1000000

# Add variable label
sl2019_dhs_ir = new_var_label(sl2019_dhs_ir,
                              &quot;Women&#39;s individual sample weight (6 decimals) (recode)&quot;)</code></pre>
</div>
<div id="step-3d-create-supporting-files" class="section level2">
<h2>Step 3D: Create supporting files</h2>
<p>The final step before beginning the harmonization process is to
create some supporting documents that will help you along the way.</p>
<p>First, in Excel, create a blank workbook called
<code>[Country name] Harmonization - Output.xlsx</code>. You will send
weighted frequency tables of the harmonized variables to this workbook
in Step 4. Also, in <code>R</code>, use the
<code>createWorkbook()</code> function to create an empty object that
will help you send the harmonized output to Excel.</p>
<pre class="r"><code>sl_harmonization_output = createWorkbook()</code></pre>
<p>Next, in Excel, create a blank workbook called
<code>[Country name] Harmonization - Recodes.xlsx</code>. You will use
this to stay organized during the process of category harmonization.
Each sheet of this workbook should look something like the
following:</p>
<div class="figure">
<img src="img/manual_step_3d.png" id="id" class="class"
style="width:70.0%;height:70.0%" alt="" />
<p class="caption">Harmonization flowchart</p>
</div>
<p>Finally, create a document to take notes, either in Microsoft Word,
Google Docs, or your preferred note-taking software. Aligning the
categories of different variables between the IPUMS and DHS samples
requires some decision making, so you will want a space to jot down your
justifications for these decisions.</p>
</div>
</div>
<div id="step-4-variable-harmonization" class="section level1">
<h1>Step 4: Variable harmonization</h1>
<div id="step-4a-category-alignment" class="section level2">
<h2>Step 4A: Category alignment</h2>
<p>The easiest way to demonstrate the harmonization process is through
specific examples, so we will describe the harmonization of the
<code>religion</code> variable for the Sierra Leone data. It is
reasonable to assume that a woman’s religion might influence her use of
and/or demand for contraception, so we would like to include
<code>religion</code> in our models for the three DHS indicators.</p>
<p>In Step 2B, we identified <code>V130</code> as the religion variable
from the DHS sample and <code>SL2015A_RELIG</code> as the religion
variable from the IPUMS sample. First, as an exploratory task, we use
the user-defined function
<code>compare_categories()' to run a quick weighted tabulation on these two variables. Note that we use the individual sample weights</code>V005R<code>and</code>PERWT`
to weight the DHS and IPUMS samples, respectively.</p>
<pre class="r"><code>compare_categories(ipums_data = &quot;sl2015_ipums&quot;, ipums_var = &quot;SL2015A_RELIG&quot;,
                   ipums_weight = &quot;PERWT&quot;, dhs_data = &quot;sl2019_dhs_ir&quot;,
                   dhs_var = &quot;V130&quot;, dhs_weight = &quot;V005R&quot;)</code></pre>
<div class="figure">
<img src="img/manual_step_4a_wiki.png" id="id" class="class"
style="width:70.0%;height:70.0%" alt="" />
<p class="caption">Harmonization flowchart</p>
</div>
<p>We find that <code>SL2015A_RELIG</code> has more categories than
<code>V130</code>, so the main harmonization task in this particular
instance will be to consolidate the categories of
<code>SL2015A_RELIG</code> to match those of <code>V130</code>.</p>
<p>I suggest moving out of <code>RStudio</code> temporarily and aligning
these categories in the Excel workbook
<code>[Country name] Harmonization - Recodes.xlsx</code> from Step 3D.
The finished product can be seen below:</p>
<div class="figure">
<img src="img/manual_step_4a.png" id="id" class="class"
style="width:70.0%;height:70.0%" alt="" />
<p class="caption">Harmonization flowchart</p>
</div>
<p>A couple things to note:</p>
<ul>
<li>Column C contains the categories from the IPUMS variable
<code>SL2015A_RELIG</code>.</li>
<li>Column E contains the categories from the DHS variable
<code>V130</code>. Bahai and Traditional actually <em>are</em>
categories of the DHS variable <code>V130</code>, but they do not show
up in the weighted frequency table above because zero cases were
recorded in each of them.</li>
<li>Column B contains the harmonized variable labels, which were
determined during this process of category alignment. Column A contains
an arbitrary numbering of these harmonized variable labels.</li>
</ul>
<p>Harmonizing <code>SL2015A_RELIG</code> and <code>V130</code> is
relatively straightforward. The six Christian denominations in
<code>SL2015A_RELIG</code> can be matched with the single Christian
category in <code>V130</code>. In both variables, there is one category
for Islam, so these can be aligned next. In the weighted frequency
tables above, we observe that Christianity and Islam account for close
to 100% of the cases in both variables, and none of the remaining
categories in either <code>SL2015A_RELIG</code> or <code>V130</code>
have a significant number of cases. Therefore, it makes the most sense
to combine the remaining labels into a harmonized category called
“Other”.</p>
</div>
<div id="step-4b-create-harmonized-ipums-and-dhs-variables"
class="section level2">
<h2>Step 4B: Create harmonized IPUMS and DHS variables</h2>
<p>Now we will move back into <code>RStudio</code> and create the
harmonized variables for both IPUMS and DHS. First, use the
<code>fre()</code> function from the <code>expss</code> package to save
a copy of the weighted frequency table from above:</p>
<pre class="r"><code>freq_RELIG = fre(sl2015_ipums$SL2015A_RELIG, weight = sl2015_ipums$PERWT)</code></pre>
<p>Next, use the <code>factor()</code> and <code>ifelse()</code>
functions to create the harmonized IPUMS variable. If you are unfamiliar
with these functions, you can check out their respective help pages here
(<a
href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/factor"
class="uri">https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/factor</a>)
and here (<a
href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/ifelse"
class="uri">https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/ifelse</a>).
We suggest naming the new variable <code>SL2015A_RELIGR</code>, which is
just the original variable name with the letter “R” appended (“R” stands
for “recode”).</p>
<pre class="r"><code>sl2015_ipums$SL2015A_RELIGR = 
  factor(ifelse(sl2015_ipums$SL2015A_RELIG == &quot;Catholic&quot; |
                 sl2015_ipums$SL2015A_RELIG == &quot;Anglican&quot; |
                 sl2015_ipums$SL2015A_RELIG == &quot;Methodist&quot; |
                 sl2015_ipums$SL2015A_RELIG == &quot;Seventh-day Adventists (SDA)&quot; |
                 sl2015_ipums$SL2015A_RELIG == &quot;Pentecostal&quot; |
                 sl2015_ipums$SL2015A_RELIG == &quot;Other Christian&quot;,
               &quot;Christian&quot;,
               ifelse(sl2015_ipums$SL2015A_RELIG == &quot;Islam&quot;,
                      &quot;Islam&quot;,
                      ifelse(sl2015_ipums$SL2015A_RELIG == &quot;Bahai&quot; |
                               sl2015_ipums$SL2015A_RELIG == &quot;Traditional&quot; |
                               sl2015_ipums$SL2015A_RELIG == &quot;Other&quot; |
                               sl2015_ipums$SL2015A_RELIG == &quot;No religion&quot;,
                             &quot;Other&quot;, NA))),
        levels = c(&quot;Christian&quot;, &quot;Islam&quot;, &quot;Other&quot;))</code></pre>
<p>The general idea behind these lines of code is as follows: If an
individual is labeled as “Catholic”, “Anglican”, “Methodist”,
“Seventh-day Adventists (SDA)”, “Pentecostal”, and “Other Christian” in
the original variable, assign them to a category called “Christian” in
the harmonized variable. If they are in the “Islam” category in the
original variable, assign them to a category called “Christian” in the
harmonized variable. If they are assigned to “Bahai”, “Traditional”,
“Other”, or “No religion” in the original variable, assign them to
“Other” in the harmonized variable. If any individuals are not covered
by these three rules, mark them as missing (<code>NA</code>). (Note that
no cases should be missing in the harmonized variable — if you notice
any <code>NA</code> cases when tabulating the harmonized variable, you
should go back and fix this issue.)</p>
<p>Next, use the user-defined function <code>new_var_label()</code> to
assign a variable label to <code>SL2015A_RELIGR</code>. We suggest using
a standard convention variable label where you simply append “(recode)”
to the original variable label:</p>
<pre class="r"><code>sl2015_ipums = new_var_label(sl2015_ipums, &quot;Religion (recode)&quot;)</code></pre>
<p>Finally, check your work by generating a weighted frequency table of
the harmonized IPUMS variable:</p>
<pre class="r"><code>freq_RELIGR = fre(sl2015_ipums$SL2015A_RELIGR, weight = sl2015_ipums$PERWT)
print(freq_RELIGR[,c(1:2, 4)])</code></pre>
<div class="figure">
<img src="img/manual_step_4b_wiki_1.png" id="id" class="class"
style="width:70.0%;height:70.0%" alt="" />
<p class="caption">Harmonization flowchart</p>
</div>
<p>We have successfully created the harmonized IPUMS variable for
<code>religion</code>, and we can basically apply the same procedures to
create the harmonized DHS variable. First, we save a copy of the
weighted frequency table:</p>
<pre class="r"><code>V130_freq = fre(sl2019_dhs_ir$V130, weight = sl2019_dhs_ir$V005R, drop_unused_labels = FALSE)</code></pre>
<p>Next, we use <code>factor()</code> and <code>ifelse()</code> to
create the harmonized variable, which we name <code>V130R</code>. We
also add a variable label for <code>V130R</code>:</p>
<pre class="r"><code># Create harmonized DHS variable
sl2019_dhs_ir$V130R = factor(ifelse(sl2019_dhs_ir$V130 == &quot;Christian&quot;,
                                    &quot;Christian&quot;,
                                    ifelse(sl2019_dhs_ir$V130 == &quot;Islam&quot;,
                                           &quot;Islam&quot;,
                                           ifelse(sl2019_dhs_ir$V130 == &quot;Bahai&quot; |
                                                    sl2019_dhs_ir$V130 == &quot;Traditional&quot; |
                                                    sl2019_dhs_ir$V130 == &quot;Other&quot; |
                                                    sl2019_dhs_ir$V130 == &quot;None&quot;,
                                                  &quot;Other&quot;, NA))),
                             levels = c(&quot;Christian&quot;, &quot;Islam&quot;, &quot;Other&quot;))

# Add variable label
sl2019_dhs_ir = new_var_label(sl2019_dhs_ir, &quot;Religion (recode)&quot;)</code></pre>
<p>Finally, we generate a weighted frequency table for the harmonized
DHS variable:</p>
<pre class="r"><code>V130R_freq = frequency(sl2019_dhs_ir$V130R, weight = sl2019_dhs_ir$V005R, drop_unused_labels = FALSE)
print(V130R_freq[,c(1:2, 4)])</code></pre>
<div class="figure">
<img src="img/manual_step_4b_wiki_2.png" id="id" class="class"
style="width:70.0%;height:70.0%" alt="" />
<p class="caption">Harmonization flowchart</p>
</div>
</div>
<div id="step-4c-write-harmonization-output-to-excel"
class="section level2">
<h2>Step 4C: Write harmonization output to Excel</h2>
<p>Now that we have created the harmonized variables for both the IPUMS
data and the DHS data, we can organize our work in the Excel workbook
<code>[Country name] Harmonization - Output.xlsx</code> that you created
in Step 3D. Use the <code>addWorksheet()</code> function from the
<code>openxlsx</code> package to create a new sheet called “Religion”
within your workbook:</p>
<pre class="r"><code>addWorksheet(sl_harmonization_output, &quot;Religion&quot;)</code></pre>
<p>Next, use the user-defined functions
<code>write_ipums_output()</code> and <code>write_dhs_output()</code> to
paste the weighted frequency tables for the harmonized IPUMS and DHS
variables into this Excel sheet:</p>
<pre class="r"><code>write_ipums_output(workbook_name = sl_harmonization_output,
                   sheet_name = &quot;Religion&quot;,
                   ipums_data = sl2015_ipums,
                   ipums_var_names = c(&quot;SL2015A_RELIGR&quot;, &quot;SL2015A_RELIG&quot;),
                   ipums_freq_tables = list(freq_RELIGR, freq_RELIG),
                   output_start_row = 1)

write_dhs_output(workbook_name = sl_harmonization_output,
                 sheet_name = &quot;Religion&quot;,
                 dhs_data = sl2019_dhs_ir,
                 dhs_var_names = c(&quot;V130R&quot;, &quot;V130&quot;),
                 dhs_freq_tables = list(V130R_freq, V130_freq),
                 output_start_row = 1)</code></pre>
<p>Finally, use the <code>saveWorkbook()</code> function to save your
Excel file:</p>
<pre class="r"><code>saveWorkbook(sl_harmonization_output, file = &quot;Sierra Leone harmonization - Output.xlsx&quot;,
             overwrite = TRUE)</code></pre>
<p>After completing these steps, the “Religion” sheet in
<code>[Country name] Harmonization - Output.xlsx</code> will look like
this:</p>
<div class="figure">
<img src="img/manual_step_4c.png" id="id" class="class"
style="width:70.0%;height:70.0%" alt="" />
<p class="caption">Harmonization flowchart</p>
</div>
<p>We can see that the IPUMS variables appear on the left, with the
harmonized variable <code>SL2015A_RELIGR</code> on top and the original
variable <code>SL2015A_RELIG</code> on the bottom. The DHS variables
appear on the right, with the harmonized variable <code>V130R</code> on
top and the original variable <code>V130</code> on the bottom.</p>
<p>You should compare the percentages in columns C and K for the
harmonized variables. Assuming that (1) the DHS data form a
representative sample of the IPUMS data and (2) the categories of the
variables used to construct the harmonized variables are comparable
between IPUMS and DHS, these percentages should be very similar. Here,
we see that both of these conditions appear to be satisfied, as the
percentages are similar for Christian (23.8% vs. 23.2%), Islam (75.3%
vs. 76.8%), and Other (0.9% vs. 0.05%).</p>
</div>
<div id="step-4d-miscellaneous-notes" class="section level2">
<h2>Step 4D: Miscellaneous notes</h2>
<p><em>Handling unknown cases:</em></p>
<p>Some of the variables used to construct the harmonized IPUMS and DHS
variables will have cases labeled as “unknown” (or something to that
effect). These unknown cases almost always constitute a very small
proportion of the total sample, so it typically won’t matter how you
classify them in Step 4A. For the Sierra Leone case study, we took the
following approach:</p>
<ul>
<li>If the harmonized variable has a category called “other” (or
something to that effect), simply assign the unknown cases to that
category.</li>
<li>If the harmonized variable does not have a category called “other”,
assign the unknown cases to the category with the highest number of
cases.</li>
</ul>
<p>For the religion example above, if there were unknown cases in either
<code>SL2015A_RELIG</code> or <code>V130</code>, we would have assigned
them to the “Other” category in the corresponding harmonized variable.
In contrast, the image in Step 3D illustrates that in the case of
marital status, the unknown cases in the variable
<code>SL2015A_MARST</code> were assigned to the “Married” category
(which must have been identified as the category with the highest number
of cases in <code>SL2015A_MARST</code>).</p>
<p><em>Creating the DHS indicators:</em></p>
<p>At this stage, you should also create variables for your DHS
indicators of interest (if they are not already in a suitable format in
the DHS data set). You can use the same procedures described in Steps 4A
through 4C above, although you will not have to worry about the
IPUMS-related steps.</p>
<p>For example, we used the following code to create the variable for
any contraceptive use, which was one of the three indicators of interest
for the Sierra Leone case study:</p>
<pre class="r"><code>### Step 4A

compare_categories(ipums_data = NULL, ipums_var = NULL, ipums_weight = NULL,
                   dhs_data = &quot;sl2019_dhs_ir&quot;, dhs_var = &quot;V313&quot;, dhs_weight = &quot;V005R&quot;)


### Step 4B

# Original DHS variable
V313_freq = fre(sl2019_dhs_ir$V313, weight = sl2019_dhs_ir$V005R)

# Harmonized DHS variable
sl2019_dhs_ir$V313R1 = factor(ifelse(sl2019_dhs_ir$V313 == &quot;Folkloric method&quot; |
                                      sl2019_dhs_ir$V313 == &quot;Traditional method&quot; |
                                      sl2019_dhs_ir$V313 == &quot;Modern method&quot;,
                                    1,
                                    ifelse(sl2019_dhs_ir$V313 == &quot;No method&quot;,
                                           0, NA)),
                             levels = c(1, 0))

# New label for harmonized DHS variable
sl2019_dhs_ir = new_var_label(sl2019_dhs_ir, &quot;Any contraceptive use&quot;)

# Weighted frequency table for harmonized DHS variable
V313R1_freq = fre(sl2019_dhs_ir$V313R1, weight = sl2019_dhs_ir$V005R)


### Step 4C

addWorksheet(sl_harmonization_output, &quot;Any contraceptive use&quot;)

write_dhs_output(workbook_name = sl_harmonization_output,
                 sheet_name = &quot;Any contraceptive use&quot;,
                 dhs_data = sl2019_dhs_ir,
                 dhs_var_names = c(&quot;V313R1&quot;, &quot;V313&quot;), 
                 dhs_freq_tables = list(V313R1_freq, V313_freq),
                 output_start_row = 1)

saveWorkbook(sl_harmonization_output, file = &quot;Sierra Leone harmonization - Output.xlsx&quot;,
             overwrite = TRUE)</code></pre>
<p>One important thing to note here: In order to be compatible with the
SAE app, the harmonized variable should be binary with values
<code>0</code> or <code>1</code>. For example, in the variable above
that records whether the woman used any contraceptive method, a value of
<code>1</code> indicates that she did, while a value of <code>0</code>
indicates that she did not.</p>
<p><em>Creating the census area variable:</em></p>
<p>At this stage, you should also create the census area variable (if it
is not already in a suitable format in the IPUMS data set). As a
reminder, the census area variable is usually the second IPUMS
administrative level; in the case of Sierra Leone, chiefdom is the
census area variable. By the principles of SAE, this variable should
appear in the IPUMS sample, but not the DHS sample. Therefore, you can
follow the procedures described in Steps 4A through 4C above, but you
will not have to worry about the DHS-related steps.</p>
</div>
</div>
<div id="step-5-create-harmonized-data-files" class="section level1">
<h1>Step 5: Create harmonized data files</h1>
<div id="step-5a-create-harmonized-ipums-data-set"
class="section level2">
<h2>Step 5A: Create harmonized IPUMS data set</h2>
<p>Once you have applied the procedures from Step 4 to all of the
variables identified in Step 2B, the final step is to create two .csv
files that contain the harmonized IPUMS and DHS variables,
respectively.</p>
<p>First, create a data frame containing the following variables in the
following order:</p>
<ul>
<li>Survey area (typically the first IPUMS administrative level; for
Sierra Leone, district is the survey area)</li>
<li>Census area (typically the second IPUMS administrative level; for
Sierra Leone, chiefdom is the survey area)</li>
<li>All of the other variables you harmonized in Step 4</li>
</ul>
<p>For Sierra Leone, we used the following code to create this data
frame:</p>
<pre class="r"><code>sl_harmonized_ipums = data.frame(sl2015_ipums$GEO1ALT_SL2015R, sl2015_ipums$GEO2ALT_SL2015R,
                                 sl2015_ipums$SL2015A_AGER1, sl2015_ipums$SL2015A_MARSTR,
                                 sl2015_ipums$SL2015A_EDATTAINR1, sl2015_ipums$SL2015A_CHSURVR2,
                                 sl2015_ipums$SL2015A_CHBORNR2, sl2015_ipums$SL2015A_URBAN17R,
                                 sl2015_ipums$SL2015A_ACTIVITYR, sl2015_ipums$SL2015A_FLOORR,
                                 sl2015_ipums$SL2015A_WALLSR2, sl2015_ipums$SL2015A_ROOFR,
                                 sl2015_ipums$SL2015A_WATDRNKR, sl2015_ipums$SL2015A_LIGHTR,
                                 sl2015_ipums$SL2015A_TOILETR2, sl2015_ipums$SL2015A_RELIGR,
                                 sl2015_ipums$SL2015A_LANGPRIMR1, sl2015_ipums$SL2015A_RELATER,
                                 sl2015_ipums$SL2015A_FUELCKR, sl2015_ipums$SL2015A_ETHNICR,
                                 sl2015_ipums$SL2015A_LITR, sl2015_ipums$SL2015A_SMOKER,
                                 sl2015_ipums$SL2015A_OCCR)</code></pre>
<p>Next, assign simpler names to the harmonized variables by renaming
the columns of this data frame. For example, instead of the harmonized
IPUMS and DHS variables for marital status being named
<code>sl2015A_MARSTR</code> and <code>V501R</code>, we will rename them
both as <code>marst</code>.</p>
<pre class="r"><code>colnames(sl_harmonized_ipums) = c(&quot;REGNAME&quot;, &quot;ADMIN_NAME&quot;,
                                  &quot;age&quot;, &quot;marst&quot;, &quot;edattain&quot;, &quot;chsurv&quot;,
                                  &quot;chborn&quot;, &quot;urban&quot;, &quot;activity&quot;, &quot;floor&quot;,
                                  &quot;walls&quot;, &quot;roof&quot;, &quot;water&quot;, &quot;electricity&quot;,
                                  &quot;toilet&quot;, &quot;religion&quot;, &quot;language&quot;, &quot;relate&quot;,
                                  &quot;fuelcook&quot;, &quot;ethnicity&quot;, &quot;literacy&quot;,
                                  &quot;tobacco&quot;, &quot;occupation&quot;)</code></pre>
<p>Note: In order to be compatible with the SAE app, the new names of
the survey area and census area must match their names in the DHS and
IPUMS shapefiles, respectively. For Sierra Leone, the district variable
in the DHS shapefile is called <code>REGNAME</code> and the chiefdom
variable in the IPUMS shapefile is called <code>ADMIN_NAME</code>. Thus,
we have to use these names instead of something more digestible like
“district” and “chiefdom”.</p>
<p>Finally, use the <code>write.csv()</code> function to send the
harmonized IPUMS data set to a .csv file:</p>
<pre class="r"><code>write.csv(sl_harmonized_ipums, file = &quot;sl_harmonized_ipums.csv&quot;, row.names = FALSE)</code></pre>
</div>
<div id="step-5b-create-harmonized-dhs-data-set" class="section level2">
<h2>Step 5B: Create harmonized DHS data set</h2>
<p>We repeat the procedures from Step 5A for the harmonized DHS
variables. First, create a data frame containing the following variables
in the following order:</p>
<ul>
<li>DHS cluster number (this should be variable <code>V001</code>)</li>
<li>Rescaled sample weight from Step 3C (this should be variable
<code>V005R</code>)</li>
<li>DHS indicators</li>
<li>Survey area (typically the first IPUMS administrative level; for
Sierra Leone, district is the survey area)</li>
<li>All of the other variables you harmonized in Step 4</li>
</ul>
<p>For Sierra Leone, we used the following code to create this data
frame:</p>
<pre class="r"><code>sl_harmonized_dhs = data.frame(sl2019_dhs_ir$V001, sl2019_dhs_ir$V005R,
                               sl2019_dhs_ir$V313R1, sl2019_dhs_ir$V313R2,
                               sl2019_dhs_ir$V626R, sl2019_dhs_ir$SDISTR,
                               sl2019_dhs_ir$V013, sl2019_dhs_ir$V501R,
                               sl2019_dhs_ir$V149R1, sl2019_dhs_ir$V218R2,
                               sl2019_dhs_ir$V201R2, sl2019_dhs_ir$V102R,
                               sl2019_dhs_ir$V731R, sl2019_dhs_ir$V127R,
                               sl2019_dhs_ir$V128R2, sl2019_dhs_ir$V129R,
                               sl2019_dhs_ir$V113R, sl2019_dhs_ir$V119R,
                               sl2019_dhs_ir$V116R2, sl2019_dhs_ir$V130R,
                               sl2019_dhs_ir$V045CR1,  sl2019_dhs_ir$V150R,
                               sl2019_dhs_ir$V161R, sl2019_dhs_ir$V131R,
                               sl2019_dhs_ir$V155R, sl2019_dhs_ir$V463ZR,
                               sl2019_dhs_ir$V717R)</code></pre>
<p>Next, just like in Step 5A, assign simpler names to the harmonized
variables by renaming the columns of this data frame:</p>
<pre class="r"><code>colnames(sl_harmonized_dhs) = c(&quot;cluster_number&quot;, &quot;weight&quot;, &quot;contraceptive_any&quot;,
                                &quot;contraceptive_modern&quot;, &quot;unmet_need&quot;, &quot;REGNAME&quot;, &quot;age&quot;, 
                                &quot;marst&quot;, &quot;edattain&quot;, &quot;chsurv&quot;, &quot;chborn&quot;, &quot;urban&quot;,
                                &quot;activity&quot;, &quot;floor&quot;, &quot;walls&quot;, &quot;roof&quot;, &quot;water&quot;,
                                &quot;electricity&quot;, &quot;toilet&quot;, &quot;religion&quot;, &quot;language&quot;,
                                &quot;relate&quot;, &quot;fuelcook&quot;, &quot;ethnicity&quot;, &quot;literacy&quot;,
                                &quot;tobacco&quot;, &quot;occupation&quot;)</code></pre>
<p>Finally, use the <code>write.csv()</code> function to send the
harmonized IPUMS data set to a .csv file:</p>
<pre class="r"><code>write.csv(sl_harmonized_dhs, file = &quot;sl_harmonized_dhs.csv&quot;, row.names = FALSE)</code></pre>
</div>
</div>
<div id="step-4-variable-harmonization-1" class="section level1">
<h1>Step 4: Variable harmonization</h1>
<div id="step-4a-category-alignment-1" class="section level2">
<h2>Step 4A: Category alignment</h2>
<p>The easiest way to demonstrate the harmonization process is through
specific examples, so we will describe the harmonization of the
<code>religion</code> variable for the Sierra Leone data. It is
reasonable to assume that a woman’s religion might influence her use of
and/or demand for contraception, so we would like to include
<code>religion</code> in our models for the three DHS indicators.</p>
<p>In Step 2B, we identified <code>V130</code> as the religion variable
from the DHS sample and <code>SL2015A_RELIG</code> as the religion
variable from the IPUMS sample. First, as an exploratory task, we use
the user-defined function
<code>compare_categories()' to run a quick weighted tabulation on these two variables. Note that we use the individual sample weights</code>V005R<code>and</code>PERWT`
to weight the DHS and IPUMS samples, respectively.</p>
<pre class="r"><code>compare_categories(ipums_data = &quot;sl2015_ipums&quot;, ipums_var = &quot;SL2015A_RELIG&quot;,
                   ipums_weight = &quot;PERWT&quot;, dhs_data = &quot;sl2019_dhs_ir&quot;,
                   dhs_var = &quot;V130&quot;, dhs_weight = &quot;V005R&quot;)</code></pre>
<div class="figure">
<img src="img/manual_step_4a_wiki.png" id="id" class="class"
style="width:70.0%;height:70.0%" alt="" />
<p class="caption">Harmonization flowchart</p>
</div>
<p>We find that <code>SL2015A_RELIG</code> has more categories than
<code>V130</code>, so the main harmonization task in this particular
instance will be to consolidate the categories of
<code>SL2015A_RELIG</code> to match those of <code>V130</code>.</p>
<p>I suggest moving out of <code>RStudio</code> temporarily and aligning
these categories in the Excel workbook
<code>[Country name] Harmonization - Recodes.xlsx</code> from Step 3D.
The finished product can be seen below:</p>
<div class="figure">
<img src="img/manual_step_4a.png" id="id" class="class"
style="width:70.0%;height:70.0%" alt="" />
<p class="caption">Harmonization flowchart</p>
</div>
<p>A couple things to note:</p>
<ul>
<li>Column C contains the categories from the IPUMS variable
<code>SL2015A_RELIG</code>.</li>
<li>Column E contains the categories from the DHS variable
<code>V130</code>. Bahai and Traditional actually <em>are</em>
categories of the DHS variable <code>V130</code>, but they do not show
up in the weighted frequency table above because zero cases were
recorded in each of them.</li>
<li>Column B contains the harmonized variable labels, which were
determined during this process of category alignment. Column A contains
an arbitrary numbering of these harmonized variable labels.</li>
</ul>
<p>Harmonizing <code>SL2015A_RELIG</code> and <code>V130</code> is
relatively straightforward. The six Christian denominations in
<code>SL2015A_RELIG</code> can be matched with the single Christian
category in <code>V130</code>. In both variables, there is one category
for Islam, so these can be aligned next. In the weighted frequency
tables above, we observe that Christianity and Islam account for close
to 100% of the cases in both variables, and none of the remaining
categories in either <code>SL2015A_RELIG</code> or <code>V130</code>
have a significant number of cases. Therefore, it makes the most sense
to combine the remaining labels into a harmonized category called
“Other”.</p>
</div>
<div id="step-4b-create-harmonized-ipums-and-dhs-variables-1"
class="section level2">
<h2>Step 4B: Create harmonized IPUMS and DHS variables</h2>
<p>Now we will move back into <code>RStudio</code> and create the
harmonized variables for both IPUMS and DHS. First, use the
<code>fre()</code> function from the <code>expss</code> package to save
a copy of the weighted frequency table from above:</p>
<pre class="r"><code>freq_RELIG = fre(sl2015_ipums$SL2015A_RELIG, weight = sl2015_ipums$PERWT)</code></pre>
<p>Next, use the <code>factor()</code> and <code>ifelse()</code>
functions to create the harmonized IPUMS variable. If you are unfamiliar
with these functions, you can check out their respective help pages here
(<a
href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/factor"
class="uri">https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/factor</a>)
and here (<a
href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/ifelse"
class="uri">https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/ifelse</a>).
We suggest naming the new variable <code>SL2015A_RELIGR</code>, which is
just the original variable name with the letter “R” appended (“R” stands
for “recode”).</p>
<pre class="r"><code>sl2015_ipums$SL2015A_RELIGR = 
  factor(ifelse(sl2015_ipums$SL2015A_RELIG == &quot;Catholic&quot; |
                 sl2015_ipums$SL2015A_RELIG == &quot;Anglican&quot; |
                 sl2015_ipums$SL2015A_RELIG == &quot;Methodist&quot; |
                 sl2015_ipums$SL2015A_RELIG == &quot;Seventh-day Adventists (SDA)&quot; |
                 sl2015_ipums$SL2015A_RELIG == &quot;Pentecostal&quot; |
                 sl2015_ipums$SL2015A_RELIG == &quot;Other Christian&quot;,
               &quot;Christian&quot;,
               ifelse(sl2015_ipums$SL2015A_RELIG == &quot;Islam&quot;,
                      &quot;Islam&quot;,
                      ifelse(sl2015_ipums$SL2015A_RELIG == &quot;Bahai&quot; |
                               sl2015_ipums$SL2015A_RELIG == &quot;Traditional&quot; |
                               sl2015_ipums$SL2015A_RELIG == &quot;Other&quot; |
                               sl2015_ipums$SL2015A_RELIG == &quot;No religion&quot;,
                             &quot;Other&quot;, NA))),
        levels = c(&quot;Christian&quot;, &quot;Islam&quot;, &quot;Other&quot;))</code></pre>
<p>The general idea behind these lines of code is as follows: If an
individual is labeled as “Catholic”, “Anglican”, “Methodist”,
“Seventh-day Adventists (SDA)”, “Pentecostal”, and “Other Christian” in
the original variable, assign them to a category called “Christian” in
the harmonized variable. If they are in the “Islam” category in the
original variable, assign them to a category called “Christian” in the
harmonized variable. If they are assigned to “Bahai”, “Traditional”,
“Other”, or “No religion” in the original variable, assign them to
“Other” in the harmonized variable. If any individuals are not covered
by these three rules, mark them as missing (<code>NA</code>). (Note that
no cases should be missing in the harmonized variable — if you notice
any <code>NA</code> cases when tabulating the harmonized variable, you
should go back and fix this issue.)</p>
<p>Next, use the user-defined function <code>new_var_label()</code> to
assign a variable label to <code>SL2015A_RELIGR</code>. We suggest using
a standard convention variable label where you simply append “(recode)”
to the original variable label:</p>
<pre class="r"><code>sl2015_ipums = new_var_label(sl2015_ipums, &quot;Religion (recode)&quot;)</code></pre>
<p>Finally, check your work by generating a weighted frequency table of
the harmonized IPUMS variable:</p>
<pre class="r"><code>freq_RELIGR = fre(sl2015_ipums$SL2015A_RELIGR, weight = sl2015_ipums$PERWT)
print(freq_RELIGR[,c(1:2, 4)])</code></pre>
<div class="figure">
<img src="img/manual_step_4b_wiki_1.png" id="id" class="class"
style="width:70.0%;height:70.0%" alt="" />
<p class="caption">Harmonization flowchart</p>
</div>
<p>We have successfully created the harmonized IPUMS variable for
<code>religion</code>, and we can basically apply the same procedures to
create the harmonized DHS variable. First, we save a copy of the
weighted frequency table:</p>
<pre class="r"><code>V130_freq = fre(sl2019_dhs_ir$V130, weight = sl2019_dhs_ir$V005R, drop_unused_labels = FALSE)</code></pre>
<p>Next, we use <code>factor()</code> and <code>ifelse()</code> to
create the harmonized variable, which we name <code>V130R</code>. We
also add a variable label for <code>V130R</code>:</p>
<pre class="r"><code># Create harmonized DHS variable
sl2019_dhs_ir$V130R = factor(ifelse(sl2019_dhs_ir$V130 == &quot;Christian&quot;,
                                    &quot;Christian&quot;,
                                    ifelse(sl2019_dhs_ir$V130 == &quot;Islam&quot;,
                                           &quot;Islam&quot;,
                                           ifelse(sl2019_dhs_ir$V130 == &quot;Bahai&quot; |
                                                    sl2019_dhs_ir$V130 == &quot;Traditional&quot; |
                                                    sl2019_dhs_ir$V130 == &quot;Other&quot; |
                                                    sl2019_dhs_ir$V130 == &quot;None&quot;,
                                                  &quot;Other&quot;, NA))),
                             levels = c(&quot;Christian&quot;, &quot;Islam&quot;, &quot;Other&quot;))

# Add variable label
sl2019_dhs_ir = new_var_label(sl2019_dhs_ir, &quot;Religion (recode)&quot;)</code></pre>
<p>Finally, we generate a weighted frequency table for the harmonized
DHS variable:</p>
<pre class="r"><code>V130R_freq = frequency(sl2019_dhs_ir$V130R, weight = sl2019_dhs_ir$V005R, drop_unused_labels = FALSE)
print(V130R_freq[,c(1:2, 4)])</code></pre>
<div class="figure">
<img src="img/manual_step_4b_wiki_2.png" id="id" class="class"
style="width:70.0%;height:70.0%" alt="" />
<p class="caption">Harmonization flowchart</p>
</div>
</div>
<div id="step-4c-write-harmonization-output-to-excel-1"
class="section level2">
<h2>Step 4C: Write harmonization output to Excel</h2>
<p>Now that we have created the harmonized variables for both the IPUMS
data and the DHS data, we can organize our work in the Excel workbook
<code>[Country name] Harmonization - Output.xlsx</code> that you created
in Step 3D. Use the <code>addWorksheet()</code> function from the
<code>openxlsx</code> package to create a new sheet called “Religion”
within your workbook:</p>
<pre class="r"><code>addWorksheet(sl_harmonization_output, &quot;Religion&quot;)</code></pre>
</div>
</div>
<div id="appendix-user-defined-r-functions" class="section level1">
<h1>Appendix: User-defined R functions</h1>
<div id="compare_categories" class="section level2">
<h2>compare_categories</h2>
<pre class="r"><code>compare_categories = function(ipums_data = NULL, ipums_var = NULL, ipums_weight = NULL,
                              dhs_data = NULL, dhs_var = NULL, dhs_weight = NULL) {
  # This function creates a weighted frequency table for a maximum of one IPUMS 
  # variable and one DHS variable. The purpose of this function is to easily compare
  # the categories and frequencies of potentially harmonizable IPUMS and DHS 
  # variables as a preliminary step in the harmonization process.
  #
  # Inputs:
  #   ipums_data = Name of the IPUMS data frame (e.g., &quot;sl2015_ipums&quot;). Must be 
  #                 entered as a string.
  #   ipums_var = Name of the variable in the IPUMS data frame for which the table
  #                 is to be constructed (e.g., &quot;SL2015_MARST&quot;). Must be entered
  #                 as a string.
  #   ipums_weight = Name of the variable in the IPUMS data frame corresponding to 
  #                   the weight variable (e.g., &quot;PERWT&quot;). Must be entered as a string.
  #   dhs_data = Name of the DHS data frame (e.g., &quot;sl2019_dhs_ir&quot;). Must be entered 
  #               as a string.
  #   dhs_var = Name of the variable in the DHS data frame for which the table is to 
  #               be constructed (e.g., &quot;V501&quot;). Must be entered as a string.
  #   dhs_weight = Name of the variable in the IPUMS data frame corresponding to the 
  #                 weight variable (e.g., &quot;V005R&quot;). Must be entered as a string.
  #
  # Prints:
  #   Two tables of weighted counts and percents: One for ipums_var, and one for dhs_var.
  #
  
  
  if(!any(is.null(ipums_data), is.null(ipums_var), is.null(ipums_weight))) {
    IPUMS = eval(parse(text = noquote(paste0(ipums_data, &quot;$&quot;, ipums_var))))
    weight_ipums = eval(parse(text = noquote(paste0(ipums_data, &quot;$&quot;, ipums_weight))))
    
    print(noquote(paste0(&quot;IPUMS weighted frequency table for &quot;, ipums_var, &quot;:&quot;)))
    print(fre(IPUMS, weight = weight_ipums)[, c(1:2, 4)])
    
    cat(&quot;\n\n\n&quot;)
  }
  
  if(!any(is.null(dhs_data), is.null(dhs_var), is.null(dhs_weight))) {
    DHS = eval(parse(text = noquote(paste0(dhs_data, &quot;$&quot;, dhs_var))))
    weight_dhs = eval(parse(text = noquote(paste0(dhs_data, &quot;$&quot;, dhs_weight))))
    
    print(noquote(paste0(&quot;DHS weighted frequency table for &quot;, dhs_var, &quot;:&quot;)))
    print(fre(DHS, weight = weight_dhs)[, c(1:2, 4)])
  }
}</code></pre>
</div>
<div id="new_var_label" class="section level2">
<h2>new_var_label</h2>
<pre class="r"><code>new_var_label = function(dataframe, label) {
  # This function appends a variable label to a data frame.
  #
  # Inputs:
  #   dataframe = The data frame to which the user would like to append a variable label.
  #   label = Variable label that the user would like to append to the data frame. Must be
  #           a string of characters; otherwise, the function will return an error message.
  #
  # Returns:
  #   An updated version of the dataframe that includes the new variable label.
  #
  
  attr(dataframe, &quot;variable.labels&quot;) = c(attr(dataframe, &quot;variable.labels&quot;), label)
  
  return(dataframe)
}</code></pre>
</div>
<div id="write_ipums_output" class="section level2">
<h2>write_ipums_output</h2>
<pre class="r"><code>write_ipums_output = function(workbook_name, sheet_name, ipums_data, ipums_var_names, 
                              ipums_freq_tables, output_start_row = 1) {
  # This function writes the IPUMS harmonization output to an excel workbook.
  #
  # Inputs:
  #   workbook_name = Name of the object that identifies the excel workbook in which the output 
  #                   is being stored.
  #   sheet_name = Name of the sheet within workbook_name to which the output should be written.
  #   ipums_data = Name of the IPUMS dataset.
  #   ipums_var_names = Vector of IPUMS variable names indicating the variables that are to be 
  #                     written to sheet_name. Must be the same length as ipums_freq_tables, 
  #                     otherwise the function returns an error message. Must also have a length 
  #                     of no more than 3, otherwise the function returns an error message.
  #   ipums_freq_tables = List of data frames corresponding to the variables listed in ipums_var_names.
  #                       Must be the same length as ipums_var_names, otherwise the function returns 
  #                       an error message. Must also have a length of no more than 3, otherwise the 
  #                       function returns an error message.
  #
  # Returns:
  #   Nothing. The function prints the output to the excel sheet/workbook, as specified by the user.
  #
  
  if (length(ipums_var_names) != length(ipums_freq_tables)) {
    return(&quot;Error: ipums_var_names must be the same length as ipums_freq_tables.&quot;)
  }
  
  if (length(ipums_var_names) &gt; 3) {
    return(&quot;Error: ipums_var_names and ipums_freq_tables must have lengths of no more than 3.&quot;)
  }
  
  for (i in 1:length(ipums_var_names)) {
    if (i == 1) {
      writeData(workbook_name, sheet = sheet_name, startRow = output_start_row, &quot;IPUMS 2015&quot;)
      writeData(workbook_name, sheet = sheet_name, startRow = output_start_row + 1,
                attr(ipums_data, &quot;variable.labels&quot;)[which(attr(ipums_data, &quot;names&quot;) == 
                                                            ipums_var_names[i])])
      writeData(workbook_name, sheet = sheet_name, startRow = output_start_row + 3,
                cbind(ipums_freq_tables[[i]][,1], round(ipums_freq_tables[[i]][,2], 0), 
                      round(ipums_freq_tables[[i]][,-c(1,2)], 2)))
    }
    if (i == 2) {
      writeData(workbook_name, sheet = sheet_name, startRow = nrow(ipums_freq_tables[[i - 1]]) + 
                  (output_start_row + 7),
                attr(ipums_data, &quot;variable.labels&quot;)[which(attr(ipums_data, &quot;names&quot;) == 
                                                            ipums_var_names[i])])
      writeData(workbook_name, sheet = sheet_name, startRow = nrow(ipums_freq_tables[[i - 1]]) + 
                  (output_start_row + 9),
                cbind(ipums_freq_tables[[i]][,1], round(ipums_freq_tables[[i]][,2], 0), 
                      round(ipums_freq_tables[[i]][,-c(1,2)], 2)))
    }
    if (i == 3) {
      writeData(workbook_name, sheet = sheet_name, startRow = nrow(ipums_freq_tables[[i - 2]]) + 
                  nrow(ipums_freq_tables[[i - 1]]) + (output_start_row + 13),
                attr(ipums_data, &quot;variable.labels&quot;)[which(attr(ipums_data, &quot;names&quot;) == 
                                                            ipums_var_names[i])])
      writeData(workbook_name, sheet = sheet_name, startRow = nrow(ipums_freq_tables[[i - 2]]) + 
                  nrow(ipums_freq_tables[[i - 1]]) + (output_start_row + 15),
                cbind(ipums_freq_tables[[i]][,1], round(ipums_freq_tables[[i]][,2], 0), 
                      round(ipums_freq_tables[[i]][,-c(1,2)], 2)))
    }
  }
}</code></pre>
</div>
<div id="write_dhs_output" class="section level2">
<h2>write_dhs_output</h2>
<pre class="r"><code>write_dhs_output = function(workbook_name, sheet_name, dhs_data, dhs_var_names, 
                            dhs_freq_tables, output_start_row = 1) {
  # This function writes the DHS harmonization output to an excel workbook.
  #
  # Inputs:
  #   workbook_name = Name of the object that identifies the excel workbook in which the output 
  #                   is being stored.
  #   sheet_name = Name of the sheet within workbook_name to which the output should be written.
  #   dhs_data = Name of the DHS dataset.
  #   dhs_var_names = Vector of DHS variable names indicating the variables that are to be 
  #                   written to sheet_name. Must be the same length as dhs_freq_tables, otherwise 
  #                   the function returns an error message. Must also have a length of no more 
  #                   than 3, otherwise the function returns an error message.
  #   dhs_freq_tables = List of data frames corresponding to the variables listed in dhs_var_names. 
  #                     Must be the same length as dhs_var_names, otherwise the function returns an 
  #                     error message. Must also have a length of no more than 3, otherwise the 
  #                     function returns an error message.
  #
  # Returns:
  #   Nothing. The function prints the output to the excel sheet/workbook, as specified by the user.
  #
  
  if (length(dhs_var_names) != length(dhs_freq_tables)) {
    return(&quot;Error: dhs_var_names must be the same length as dhs_freq_tables.&quot;)
  }
  
  if (length(dhs_var_names) &gt; 3) {
    return(&quot;Error: dhs_var_names and dhs_freq_tables must have lengths of no more than 3.&quot;)
  }
  
  
  for (i in 1:length(dhs_var_names)) {
    if (i == 1) {
      writeData(workbook_name, sheet = sheet_name, startRow = output_start_row, startCol = 10, 
                &quot;DHS 2019&quot;)
      writeData(workbook_name, sheet = sheet_name, startRow = output_start_row + 1, startCol = 10,
                attr(dhs_data, &quot;variable.labels&quot;)[which(attr(dhs_data, &quot;names&quot;) == 
                                                          dhs_var_names[i])])
      writeData(workbook_name, sheet = sheet_name, startRow = output_start_row + 3, startCol = 10,
                cbind(dhs_freq_tables[[i]][,1], round(dhs_freq_tables[[i]][,2], 0), 
                      round(dhs_freq_tables[[i]][,-c(1,2)], 2)))
    }
    if (i == 2) {
      writeData(workbook_name, sheet = sheet_name, startRow = nrow(dhs_freq_tables[[i - 1]]) + 
                  (output_start_row + 7), startCol = 10,
                attr(dhs_data, &quot;variable.labels&quot;)[which(attr(dhs_data, &quot;names&quot;) == 
                                                          dhs_var_names[i])])
      writeData(workbook_name, sheet = sheet_name, startRow = nrow(dhs_freq_tables[[i - 1]]) + 
                  (output_start_row + 9), startCol = 10,
                cbind(dhs_freq_tables[[i]][,1], round(dhs_freq_tables[[i]][,2], 0), 
                      round(dhs_freq_tables[[i]][,-c(1,2)], 2)))
    }
    if (i == 3) {
      writeData(workbook_name, sheet = sheet_name, startRow = nrow(dhs_freq_tables[[i - 2]]) + 
                  nrow(dhs_freq_tables[[i - 1]]) + (output_start_row + 13), startCol = 10,
                attr(dhs_data, &quot;variable.labels&quot;)[which(attr(dhs_data, &quot;names&quot;) == 
                                                          dhs_var_names[i])])
      writeData(workbook_name, sheet = sheet_name, startRow = nrow(dhs_freq_tables[[i - 2]]) + 
                  nrow(dhs_freq_tables[[i - 1]]) + (output_start_row + 15), startCol = 10,
                cbind(dhs_freq_tables[[i]][,1], round(dhs_freq_tables[[i]][,2], 0), 
                      round(dhs_freq_tables[[i]][,-c(1,2)], 2)))
    }
  }
}</code></pre>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
